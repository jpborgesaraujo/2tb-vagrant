Vagrant.configure("2") do |config|
  config.vm.box = "gusztavvargadr/ubuntu-server"
  config.vm.provider "virtualbox" do |v|
    v.memory = 2048
    v.cpus = 2
  end

  config.vm.define "vm1" do |vm1|
    vm1.vm.synced_folder ".","/vagrant"
    vm1.vm.network "private_network", ip: "192.168.56.1", gateway: "192.168.56.3"
     config.vm.synced_folder ".", "/vagrant", type: "virtualbox"

     vm1.vm.network "forwarded_port", guest: 53, host: 30053
     vm1.vm.network "forwarded_port", guest: 80, host: 8080
     vm1.vm.network "forwarded_port", guest: 20, host: 20
     vm1.vm.network "forwarded_port", guest: 21, host: 21
     vm1.vm.network "forwarded_port", guest: 21100, host: 21100
     vm1.vm.network "forwarded_port", guest: 80, host: 85
     
     vm1.vm.provision "shell", inline: <<-SHELL
    sudo apt-get install 
    sudo apt update
    sudo apt-get install docker
    sudo apt install nfs-common
    sudo docker pull networkboot/dhcpd 
    sudo docker pull ubuntu/bind9
    sudo docker pull httpd:2.4
    sudo docker pull fauria/vsftpd
    sudo docker pull itsthenetwork/nfs-server-alpine
    
            
    sudo docker run -d --name networkboot/dhcpd  -v /vagrant/data:/data networkboot/dhcpd -p 85:80 networkboot/dhcpd


    sudo docker run -d --name server-dns -v /vagrant/dns/:/etc/bind/ -p 30053:53 ubuntu/bind9:latest

    sudo docker run -d --name server-apache -v /vagrant/web/:/usr/local/apache2/htdocs/ -p 8080:80 httpd:2.4

    sudo docker run -d --name server-ftp -v /vagrant/ftp:/home/vsftpd -p 20:20 -p 21:21 -p 21100-21110:21100-21110 -e FTP_USER=admin -e FTP_PASS=admin -e PASV_ADDRESS=127.0.0.1 -e PASV_MIN_PORT=21100 -e PASV_MAX_PORT=21110 fauria/vsftpd

    sudo docker run -d --name server-nfs --privileged -v /vagrant/nfs:/nfsshare  --net=host  -e SYNC=true -e SHARED_DIRECTORY=/nfsshare itsthenetwork/nfs-server-alpine:latest
            



  SHELL
    end
  

end
